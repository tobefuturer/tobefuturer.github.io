<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="&amp;#x524D;&amp;#x8A00;&amp;#x672C;&amp;#x6587;&amp;#x4F1A;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E00;&amp;#x4E2A;&amp;#x81EA;&amp;#x5DF1;&amp;#x5199;&amp;#x7684;&amp;#x5DE5;&amp;#x5177;&amp;#xFF0C;&amp;#x80FD;&amp;#x591F;&amp;#x628">
    

    <!--Author-->
    
        <meta name="author" content="杨君">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="黑科技：把第三方 iOS 应用转成动态库"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Jun&#39;s Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

        <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>黑科技：把第三方 iOS 应用转成动态库 - Jun&#39;s Blog</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">杨君的小黑屋</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/links">
                            
                                Links
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="https://github.com/tobefuturer">
                            
                                &nbsp;<i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('http://www.codeblocq.com/assets/projects/hexo-theme-clean-blog/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>黑科技：把第三方 iOS 应用转成动态库</h1>
                    
                    
                        <span class="meta">
                            <!-- Date and Author -->
                            
                            2016-10-08
                        </span>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <h1 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h1><p>&#x672C;&#x6587;&#x4F1A;&#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;&#x81EA;&#x5DF1;&#x5199;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x80FD;&#x591F;&#x628A;&#x7B2C;&#x4E09;&#x65B9;iOS&#x5E94;&#x7528;&#x8F6C;&#x6210;&#x52A8;&#x6001;&#x5E93;&#xFF0C;&#x5E76;&#x52A0;&#x8F7D;&#x5230;&#x81EA;&#x5DF1;&#x7684;App&#x4E2D;&#xFF0C;&#x6587;&#x7AE0;&#x6700;&#x540E;&#x4F1A;&#x4EE5;&#x652F;&#x4ED8;&#x5B9D;&#x4E3A;&#x4F8B;&#xFF0C;&#x5C55;&#x793A;&#x5982;&#x4F55;&#x8C03;&#x7528;&#x5176;&#x4E2D;&#x7684;C&#x51FD;&#x6570;&#x548C;OC&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x5DE5;&#x5177;&#x5F00;&#x6E90;&#x5730;&#x5740;&#xFF1A;<br><a href="https://github.com/tobefuturer/app2dylib" target="_blank" rel="external">https://github.com/tobefuturer/app2dylib</a></p>
<h1 id="&#x6709;&#x4EC0;&#x4E48;&#x7528;"><a href="#&#x6709;&#x4EC0;&#x4E48;&#x7528;" class="headerlink" title="&#x6709;&#x4EC0;&#x4E48;&#x7528;"></a>&#x6709;&#x4EC0;&#x4E48;&#x7528;</h1><p>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x628A;&#x7B2C;&#x4E09;&#x65B9;&#x5E94;&#x7528;&#x8F6C;&#x6210;&#x52A8;&#x6001;&#x5E93;&#x5462;&#xFF1F;&#x4E0E;&#x4E00;&#x822C;&#x7684;&#x6CE8;&#x5165;&#x52A8;&#x6001;&#x5E93;+&#x91CD;&#x7B7E;&#x540D;&#x6253;&#x5305;&#x7684;&#x624B;&#x6BB5;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x4E00;&#x6837;&#x5462;&#xFF1F;</p>
<p>&#x597D;&#x5904;&#x4E3B;&#x8981;&#x6709;&#x4E0B;&#x9762;&#x51E0;&#x70B9;&#xFF1A;</p>
<ol>
<li><p>&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x522B;&#x4EBA;&#x7684;&#x7B97;&#x6CD5;</p>
<p>&#x9006;&#x5411;&#x5206;&#x6790;&#x522B;&#x4EBA;&#x7684;&#x5E94;&#x7528;&#x65F6;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x9047;&#x5230;&#x4E00;&#x4E9B;&#x79C1;&#x6709;&#x7B97;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x641E;&#x4E0D;&#x5B9A;&#x7684;&#x8BDD;&#xFF0C;&#x76F4;&#x63A5;&#x62FF;&#x6765;&#x7528;&#x5C31;&#x597D;&#x3002;</p>
</li>
<li><p>&#x638C;&#x63A7;&#x7A0B;&#x5E8F;&#x7684;&#x63A7;&#x5236;&#x6743;</p>
<p>&#x7A0B;&#x5E8F;&#x7684;&#x4E3B;&#x4F53;&#x662F;&#x81EA;&#x5DF1;&#x7684;App&#xFF0C;&#x7B2C;&#x4E09;&#x65B9;&#x5E94;&#x7528;&#x7684;&#x4EE3;&#x7801;&#x53EA;&#x662F;&#x4EE5;&#x52A8;&#x6001;&#x5E93;&#x7684;&#x5F62;&#x5F0F;&#x52A0;&#x8F7D;&#xFF0C;&#x4E3B;&#x8981;&#x7684;&#x63A7;&#x5236;&#x6743;&#x8FD8;&#x662F;&#x5728;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x624B;&#x91CC;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7ED5;&#x8FC7;&#x5E94;&#x7528;&#x7684;&#x68C0;&#x6D4B;&#x4EE3;&#x7801;&#xFF08;&#x6587;&#x7AE0;&#x6700;&#x540E;&#x6709;&#x5173;&#x4E8E;&#x8FD9;&#x90E8;&#x5206;&#x653B;&#x9632;&#x7684;&#x8BA8;&#x8BBA;&#xFF09;&#x3002;</p>
</li>
<li><p>&#x540C;&#x4E2A;&#x8FDB;&#x7A0B;&#x5185;&#x52A0;&#x8F7D;&#x591A;&#x4E2A;&#x5E94;&#x7528;</p>
<p>&#x91CD;&#x7B7E;&#x540D;&#x6253;&#x5305;&#x6BD5;&#x7ADF;&#x53EA;&#x80FD;&#x662F;&#x539F;&#x6765;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x662F;&#x52A8;&#x6001;&#x5E93;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x52A0;&#x8F7D;&#x591A;&#x4E2A;&#x5E94;&#x7528;&#x5230;&#x8FDB;&#x7A0B;&#x5185;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#x4F60;&#x60F3;&#x540C;&#x65F6;&#x628A;&#x7F8E;&#x56FE;&#x79C0;&#x79C0;&#x548C;&#x997F;&#x4E86;&#x4E48;&#x52A0;&#x8F7D;&#x8FDB;&#x6765;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#xFF08;&#x79C0;&#x79C0;&#x4E0D;&#x997F;&#xFF0C;&#x60F3;&#x60F3;&#x53BB;&#x5E74;&#x5927;&#x4F17;&#x70B9;&#x8BC4;&#x90A3;&#x4E2A;APPmixer&#x7684;&#x8F6F;&#x5E7F; - -! &#xFF09;&#x3002;</p>
</li>
</ol>
<h1 id="&#x5E94;&#x7528;&#x548C;&#x52A8;&#x6001;&#x5E93;&#x7684;&#x5F02;&#x540C;"><a href="#&#x5E94;&#x7528;&#x548C;&#x52A8;&#x6001;&#x5E93;&#x7684;&#x5F02;&#x540C;" class="headerlink" title="&#x5E94;&#x7528;&#x548C;&#x52A8;&#x6001;&#x5E93;&#x7684;&#x5F02;&#x540C;"></a>&#x5E94;&#x7528;&#x548C;&#x52A8;&#x6001;&#x5E93;&#x7684;&#x5F02;&#x540C;</h1><p>&#x6211;&#x4EEC;&#x8981;&#x628A;&#x5E94;&#x7528;&#x8F6C;&#x6210;&#x52A8;&#x6001;&#x5E93;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x77E5;&#x9053;&#x8FD9;&#x4E24;&#x8005;&#x4E4B;&#x524D;&#x6709;&#x4EC0;&#x4E48;&#x76F8;&#x540C;&#x4E0E;&#x4E0D;&#x540C;&#xFF0C;&#x6709;&#x76F8;&#x540C;&#x7684;&#x624D;&#x5B58;&#x5728;&#x8F6C;&#x6362;&#x7684;&#x53EF;&#x80FD;&#xFF0C;&#x800C;&#x4E0D;&#x540C;&#x4E4B;&#x5904;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x8981;&#x91CD;&#x70B9;&#x5173;&#x6CE8;&#x7684;&#x4E86;&#x3002;</p>
<h3 id="&#x76F8;&#x540C;&#x70B9;&#xFF1A;"><a href="#&#x76F8;&#x540C;&#x70B9;&#xFF1A;" class="headerlink" title="&#x76F8;&#x540C;&#x70B9;&#xFF1A;"></a>&#x76F8;&#x540C;&#x70B9;&#xFF1A;</h3><p><img src="/posts/convert-iOS-app-to-dynamic-library/app_dylib_header_common.jpg" alt=""></p>
<p>&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x548C;&#x52A8;&#x6001;&#x5E93;&#x90FD;&#x662F;&#x6807;&#x51C6;&#x7684; Mach-O &#x6587;&#x4EF6;&#x683C;&#x5F0F;&#xFF0C;&#x4E24;&#x8005;&#x7684;&#x6587;&#x4EF6;&#x5934;&#x90E8;&#x7ED3;&#x6784;&#x975E;&#x5E38;&#x7C7B;&#x4F3C;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5176;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x6BB5;&#xFF08;TEXT&#xFF09;,&#x548C;&#x6570;&#x636E;&#x6BB5;&#xFF08;DATA&#xFF09;&#x7ED3;&#x6784;&#x5B8C;&#x5168;&#x4E00;&#x81F4;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x540E;&#x9762;&#x8F6C;&#x6362;&#x5DE5;&#x4F5C;&#x7684;&#x57FA;&#x7840;&#x3002;</p>
<h3 id="&#x4E0D;&#x540C;&#x70B9;"><a href="#&#x4E0D;&#x540C;&#x70B9;" class="headerlink" title="&#x4E0D;&#x540C;&#x70B9;"></a>&#x4E0D;&#x540C;&#x70B9;</h3><p>&#x4E0D;&#x540C;&#x70B9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x8F6C;&#x6362;&#x5DE5;&#x4F5C;&#x7684;&#x91CD;&#x70B9;&#x4E86;&#xFF0C;&#x4E3B;&#x8981;&#x6709;&#xFF1A;</p>
<ol>
<li><p>&#x5934;&#x90E8;&#x7684;&#x6587;&#x4EF6;&#x7C7B;&#x578B;<br>&#x4E00;&#x4E2A;&#x662F; MH_EXECUTE &#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C; &#x4E00;&#x4E2A;&#x662F; MH_DYLIB &#x52A8;&#x6001;&#x5E93;&#xFF0C; &#x8FD8;&#x6709;&#x5404;&#x79CD;&#x5934;&#x90E8;&#x7684;Flags&#xFF0C;&#x8981;&#x7279;&#x522B;&#x7559;&#x610F;&#x4E0B;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E2D;Flags&#x90E8;&#x5206;&#x7684; MH_PIE &#x6807;&#x5FD7;&#xFF0C;&#x540E;&#x9762;&#x518D;&#x8BE6;&#x7EC6;&#x8BF4;&#x3002;<br><img src="/posts/convert-iOS-app-to-dynamic-library/app_dylib_difference_header.jpg" alt=""></p>
</li>
<li><p>&#x52A8;&#x6001;&#x5E93;&#x6587;&#x4EF6;&#x4E2D;&#x591A;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A; LC_ID_DYLIB  &#x7684; Load Command, &#x4F5C;&#x7528;&#x662F;&#x52A8;&#x6001;&#x5E93;&#x7684;&#x6807;&#x8BC6;&#x7B26;&#xFF0C;&#x4E00;&#x822C;&#x4E3A;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x3002;&#x8DEF;&#x5F84;&#x53EF;&#x4EE5;&#x968F;&#x4FBF;&#x586B;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x90E8;&#x5206;&#x5FC5;&#x987B;&#x8981;&#x6709;&#xFF0C;&#x662F;codesign&#x7684;&#x8981;&#x6C42;&#x3002;<br><img src="/posts/convert-iOS-app-to-dynamic-library/app_dylib_difference_dylib_command.jpg" alt=""></p>
</li>
<li><p>&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4F1A;&#x591A;&#x51FA;&#x4E00;&#x4E2A; PAGEZERO&#x6BB5;&#xFF0C;&#x52A8;&#x6001;&#x5E93;&#x4E2D;&#x6CA1;&#x6709;&#x3002;&#x8FD9;&#x4E2A;&#x6BB5;&#x5F00;&#x59CB;&#x5730;&#x5740;&#x4E3A;0&#xFF08;NULL&#x6307;&#x9488;&#x6307;&#x5411;&#x7684;&#x4F4D;&#x7F6E;&#xFF09;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x53EF;&#x8BFB;&#x3001;&#x4E0D;&#x53EF;&#x5199;&#x3001;&#x4E0D;&#x53EF;&#x6267;&#x884C;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x80FD;&#x591F;&#x5728;&#x7A7A;&#x6307;&#x9488;&#x8BBF;&#x95EE;&#x65F6;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;&#x8FD9;&#x4E2A;&#x6BB5;&#x7684;&#x5927;&#x5C0F;&#xFF0C;32&#x4F4D;&#x4E0A;&#x662F;0x4000&#xFF0C;64&#x4F4D;&#x4E0A;&#x662F;4G&#x3002;&#x8FD9;&#x4E2A;&#x6BB5;&#x7684;&#x5904;&#x7406;&#x4E5F;&#x662F;&#x8F6C;&#x6362;&#x5DE5;&#x4F5C;&#x7684;&#x91CD;&#x70B9;&#x4E4B;&#x4E00;&#xFF0C;&#x4E4B;&#x524D;&#x6709;&#x4EBA;&#x5C1D;&#x8BD5;&#x8F6C;&#x6362;&#xFF0C;&#x4E0D;&#x6210;&#x529F;&#x5C31;&#x662F;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x5904;&#x7406;&#x597D; PAGEZERO.<br><img src="/posts/convert-iOS-app-to-dynamic-library/app_dylib_difference_pagezero.jpg" alt=""></p>
</li>
</ol>
<h1 id="&#x5B9E;&#x73B0;&#x7EC6;&#x8282;"><a href="#&#x5B9E;&#x73B0;&#x7EC6;&#x8282;" class="headerlink" title="&#x5B9E;&#x73B0;&#x7EC6;&#x8282;"></a>&#x5B9E;&#x73B0;&#x7EC6;&#x8282;</h1><h3 id="&#x4FEE;&#x6539;&#x6587;&#x4EF6;&#x7C7B;&#x578B;"><a href="#&#x4FEE;&#x6539;&#x6587;&#x4EF6;&#x7C7B;&#x578B;" class="headerlink" title="&#x4FEE;&#x6539;&#x6587;&#x4EF6;&#x7C7B;&#x578B;"></a>&#x4FEE;&#x6539;&#x6587;&#x4EF6;&#x7C7B;&#x578B;</h3><p>&#x7B2C;&#x4E00;&#x6B65;&#x662F;&#x4FEE;&#x6539;&#x6587;&#x4EF6;&#x7684;&#x5934;&#x90E8;&#x4FE1;&#x606F;&#xFF0C;&#x628A;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x4ECE;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4FEE;&#x6539;&#x6210;&#x52A8;&#x6001;&#x5E93;&#xFF0C;&#x540C;&#x65F6;&#x628A;&#x4E00;&#x4E9B;Flags&#x4FEE;&#x6539;&#x597D;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x5173;&#x952E;&#x7684;Flag&#x662F;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E2D;&#x7684; MH_PIE &#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#xFF08;position-independent executable&#xFF09;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#x8868;&#x660E;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x80FD;&#x591F;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x4EFB;&#x610F;&#x4F4D;&#x7F6E;&#x6B63;&#x786E;&#x5730;&#x8FD0;&#x884C;&#xFF0C;&#x800C;&#x4E0D;&#x53D7;&#x5176;&#x7EDD;&#x5BF9;&#x5730;&#x5740;&#x5F71;&#x54CD;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x8FD9;&#x4E00;&#x7279;&#x6027;&#x662F;&#x52A8;&#x6001;&#x5E93;&#x6240;&#x5FC5;&#x987B;&#x7684;&#x4E00;&#x4E2A;&#x7279;&#x6027;&#x3002;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x6807;&#x5FD7;&#x4F4D;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x662F;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x8F6C;&#x6362;&#x6210;&#x52A8;&#x6001;&#x5E93;&#x7684;&#x3002;iOS&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;arm64&#x67B6;&#x6784;&#x4E0B;&#xFF0C;&#x76EE;&#x524D;&#x8FD9;&#x4E2A;&#x6807;&#x5FD7;&#x4F4D;&#x662F;&#x5FC5;&#x987B;&#x7684;&#xFF0C;&#x4E0D;&#x7136;&#x7A0B;&#x5E8F;&#x65E0;&#x6CD5;&#x8FD0;&#x884C;&#xFF08;&#x7CFB;&#x7EDF;&#x7684;&#x5B89;&#x5168;&#x6027;&#x8981;&#x6C42;&#xFF09;&#xFF0C;&#x4F46;&#x662F;armv7&#x67B6;&#x6784;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#x6240;&#x4EE5;&#x652F;&#x4ED8;&#x5B9D;armv7&#x7248;&#x672C;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x662F;&#x4E0D;&#x80FD;&#x8F6C;&#x6210;&#x52A8;&#x6001;&#x5E93;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x539F;&#x56E0;&#x3002;&#x4E0D;&#x8FC7;&#x6240;&#x6709;&#x7684;arm64&#x7684;&#x5E94;&#x7528;&#x90FD;&#x662F;&#x53EF;&#x4EE5;&#x8F6C;&#x6362;&#x7684;&#xFF0C;&#x540E;&#x9762;&#x6F14;&#x793A;&#x65F6;&#x7528;&#x7684;&#x652F;&#x4ED8;&#x5B9D;&#x662F;arm64&#x67B6;&#x6784;&#x7684;&#x3002;</p>
<h3 id="&#x5934;&#x90E8;&#x4E2D;&#x6DFB;&#x52A0;-LC-ID-DYLIB"><a href="#&#x5934;&#x90E8;&#x4E2D;&#x6DFB;&#x52A0;-LC-ID-DYLIB" class="headerlink" title="&#x5934;&#x90E8;&#x4E2D;&#x6DFB;&#x52A0; LC_ID_DYLIB"></a>&#x5934;&#x90E8;&#x4E2D;&#x6DFB;&#x52A0; LC_ID_DYLIB</h3><p>&#x76F4;&#x63A5;&#x5728;&#x6587;&#x4EF6;&#x5934;&#x90E8;&#x4E2D;&#x6309;&#x7167;&#x6587;&#x6863;&#x683C;&#x5F0F;&#x63D2;&#x5165;&#x4E00;&#x4E2A;Load Command&#xFF0C;&#x5E76;&#x586B;&#x5165;&#x5408;&#x9002;&#x7684;&#x6570;&#x636E;&#x3002;&#x8FD9;&#x91CC;&#x8981;&#x6CE8;&#x610F;&#x4E0B;&#x63D2;&#x5165;&#x5185;&#x5BB9;&#x7684;&#x5B57;&#x8282;&#x6570;&#x5FC5;&#x987B;&#x662F;8&#x5B57;&#x8282;&#x5BF9;&#x9F50;&#x7684;&#x3002;</p>
<h3 id="&#x4FEE;&#x6539;PAGEZERO&#x6BB5;"><a href="#&#x4FEE;&#x6539;PAGEZERO&#x6BB5;" class="headerlink" title="&#x4FEE;&#x6539;PAGEZERO&#x6BB5;"></a>&#x4FEE;&#x6539;PAGEZERO&#x6BB5;</h3><p>&#x8FD9;&#x90E8;&#x5206;&#x662F;&#x6700;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x56E0;&#x4E3A;arm64&#x4E0A;&#x8FD9;&#x4E2A;&#x6BB5;&#x7684;&#x5927;&#x5C0F;&#x6709;4G&#xFF0C;&#x76F4;&#x63A5;&#x5F80;&#x5185;&#x5B58;&#x4E2D;&#x52A0;&#x8F7D;&#xFF0C;&#x4F1A;&#x63D0;&#x793A;&#x6CA1;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x8FDE;&#x7EED;&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF0C;&#x6240;&#x4EE5;&#x5FC5;&#x987B;&#x8981;&#x8C03;&#x6574;&#x8FD9;&#x4E2A;&#x6BB5;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x800C;&#x8981;&#x8C03;&#x6574; PAGEZERO &#x8FD9;&#x4E2A;&#x6BB5;&#x7684;&#x5927;&#x5C0F;, &#x53C8;&#x4F1A;&#x5F15;&#x8D77;&#x4E00;&#x8FDE;&#x4E32;&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x80FD;&#x76F2;&#x76EE;&#x7684;&#x76F4;&#x63A5;&#x6539;&#xFF0C;&#x5FC5;&#x987B;&#x7ED3;&#x5408;dyld&#x7684;&#x6E90;&#x7801;&#x6765;&#x5BF9;&#x5E94;&#x4FEE;&#x6539;&#x3002;&#xFF08;&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x628A; PAGEZERO &#x8FD9;&#x4E2A;&#x6BB5;&#x7ED9;&#x53BB;&#x6389;&#xFF0C;&#x4E5F;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x628A;&#x5927;&#x5C0F;&#x8C03;&#x6210;0&#xFF0C;&#x56E0;&#x4E3A;&#x6D89;&#x53CA;&#x5230;dyld&#x7684;rebase&#x64CD;&#x4F5C;&#xFF0C;&#x8BE6;&#x7EC6;&#x770B;&#x540E;&#x9762;&#xFF09;</p>
<h4 id="1-&#x6240;&#x6709;&#x6BB5;&#x7684;&#x5730;&#x5740;&#x90FD;&#x8981;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;"><a href="#1-&#x6240;&#x6709;&#x6BB5;&#x7684;&#x5730;&#x5740;&#x90FD;&#x8981;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;" class="headerlink" title="1. &#x6240;&#x6709;&#x6BB5;&#x7684;&#x5730;&#x5740;&#x90FD;&#x8981;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;"></a>1. &#x6240;&#x6709;&#x6BB5;&#x7684;&#x5730;&#x5740;&#x90FD;&#x8981;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;</h4><p>&#x5355;&#x7EAF;&#x51CF;&#x5C11; PAGEZERO &#x6BB5;&#x7684;&#x5360;&#x7528;&#x7A7A;&#x95F4;&#xFF0C;&#x4F5C;&#x7528;&#x4E0D;&#x5927;&#xFF0C;&#x56E0;&#x4E3A;dyld&#x52A0;&#x8F7D;&#x52A8;&#x6001;&#x5E93;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8981;&#x6C42;&#x662F;&#x6240;&#x6709;&#x7684;&#x6BB5;&#x4E00;&#x8D77;&#x8FDB;&#x884C;mmap&#xFF08;&#x8BE6;&#x7EC6;&#x53EF;&#x4EE5;&#x67E5;&#x770B;dyld&#x6E90;&#x7801;&#x7684;ImageLoaderMachO::assignSegmentAddresses&#x51FD;&#x6570;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x5FC5;&#x987B;&#x628A;&#x63A5;&#x4E0B;&#x6765;&#x6240;&#x6709;&#x7684;&#x6BB5;&#x7684;&#x5730;&#x5740;&#x90FD;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;&#x4E00;&#x6B21;&#x3002;</p>
<p>&#x540C;&#x65F6;&#x8981;&#x4FDD;&#x8BC1;&#xFF0C;&#x524D;&#x540E;&#x4E24;&#x4E2A;&#x6BB5;&#x6CA1;&#x6709;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x91CD;&#x53E0;&#xFF0C;&#x5E76;&#x4E14;&#x6BCF;&#x4E2A;&#x6BB5;&#x90FD;&#x662F;&#x6309;0x4000&#x5BF9;&#x9F50;&#x3002;&#x56E0;&#x4E3A; PAGEZERO &#x662F;&#x6240;&#x6709;&#x6BB5;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x628A;  PAGEZERO &#x7684;&#x5927;&#x5C0F;&#x8C03;&#x6574;&#x5230;0x4000&#xFF0C;&#x7136;&#x540E;&#x540E;&#x9762;&#x6BCF;&#x4E00;&#x4E2A;&#x6BB5;&#x90FD;&#x6309;&#x987A;&#x5E8F;&#x4F9D;&#x6B21;&#x51CF;&#x5C11;&#x540C;&#x6837;&#x5927;&#x5C0F;(0xFFFFC000 = 0x100000000 - 0x4000)&#xFF0C;&#x540C;&#x65F6;&#x80FD;&#x4FDD;&#x8BC1;&#x6BCF;&#x4E2A;&#x6BB5;&#x5728;&#x6587;&#x4EF6;&#x5185;&#x7684;&#x504F;&#x79FB;&#x91CF;&#x4E0D;&#x53D8;&#x3002;</p>
<p>&#x4FEE;&#x6539;&#x524D;&#xFF1A;</p>
<p><img src="/posts/convert-iOS-app-to-dynamic-library/address_space_before_modify.jpg" alt=""></p>
<p>&#x4FEE;&#x6539;&#x540E;&#xFF1A;</p>
<p><img src="/posts/convert-iOS-app-to-dynamic-library/address_space_after_modify.jpg" alt=""></p>
<h4 id="2-&#x5BF9;&#x52A8;&#x6001;&#x5E93;&#x8FDB;&#x884C;rebase&#x64CD;&#x4F5C;"><a href="#2-&#x5BF9;&#x52A8;&#x6001;&#x5E93;&#x8FDB;&#x884C;rebase&#x64CD;&#x4F5C;" class="headerlink" title="2. &#x5BF9;&#x52A8;&#x6001;&#x5E93;&#x8FDB;&#x884C;rebase&#x64CD;&#x4F5C;"></a>2. &#x5BF9;&#x52A8;&#x6001;&#x5E93;&#x8FDB;&#x884C;rebase&#x64CD;&#x4F5C;</h4><p>&#x8FD9;&#x91CC;&#x7684;rebase&#x662F;&#x7CFB;&#x7EDF;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x52A8;&#x6001;&#x5E93;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x5730;&#x5740;&#x51B2;&#x7A81;&#xFF0C;&#x5728;&#x52A0;&#x8F7D;&#x52A8;&#x6001;&#x5E93;&#x65F6;&#x8FDB;&#x884C;&#x7684;&#x57FA;&#x5730;&#x5740;&#x91CD;&#x5B9A;&#x4F4D;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x8FD9;&#x4E00;&#x6B65;&#x64CD;&#x4F5C;&#x662F;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x91CC;&#x6700;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x6309;&#x7167;&#x524D;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#xFF0C;&#x5982;&#x679C;dyld&#x4F9D;&#x7136;&#x6309;&#x7167;&#x539F;&#x6765;&#x7684;&#x5730;&#x5740;&#x8FDB;&#x884C;rebase&#xFF0C;&#x5FC5;&#x7136;&#x4F1A;&#x5931;&#x8D25;&#x3002;</p>
<p>&#x90A3;&#x4E48;rebase&#x64CD;&#x4F5C;&#x9700;&#x8981;&#x505A;&#x54EA;&#x4E9B;&#x5DE5;&#x4F5C;&#x5462;&#xFF1F;</p>
<p>&#x76F8;&#x5173;&#x7684;&#x4FE1;&#x606F;&#x50A8;&#x5B58;&#x5728; Mach-O &#x6587;&#x4EF6;&#x7684; LINKEDIT &#x6BB5;&#x4E2D;, &#x5E76;&#x7531; LC_DYLD_INFO_ONLY &#x6307;&#x5B9A; rebase info &#x5728;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x504F;&#x79FB;&#x91CF;</p>
<p><img src="/posts/convert-iOS-app-to-dynamic-library/rebase_offset.jpg" alt=""></p>
<p>&#x8BE6;&#x7EC6;&#x7684;rebase&#x4FE1;&#x606F;:</p>
<p><img src="/posts/convert-iOS-app-to-dynamic-library/rebase_info.jpg" alt=""></p>
<p>&#x7EA2;&#x6846;&#x91CC;&#x90A3;&#x4E9B;Pointer&#x7684;&#x610F;&#x601D;&#x662F;&#x8BF4;&#xFF0C;&#x5728;&#x5185;&#x5B58;&#x5730;&#x5740;&#x4E3A; 0x367C698 &#x7684;&#x5730;&#x65B9;&#x6709;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x8FD9;&#x4E2A;&#x6307;&#x9488;&#x9700;&#x8981;&#x8FDB;&#x884C;rebase&#x64CD;&#x4F5C;, &#x64CD;&#x4F5C;&#x7684;&#x5185;&#x5BB9;&#x5C31;&#x662F;&#x548C;&#x524D;&#x9762;&#x8C03;&#x6574;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x4E00;&#x6837;&#xFF0C;&#x6BCF;&#x4E2A;&#x6307;&#x9488;&#x51CF;&#x53BB; 0xFFFFC000&#x3002;</p>
<p><img src="/posts/convert-iOS-app-to-dynamic-library/rebase_subtraction.jpg" alt=""></p>
<h4 id="3-&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x53BB;&#x6389;PAGEZERO&#x8FD9;&#x4E2A;&#x6BB5;"><a href="#3-&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x53BB;&#x6389;PAGEZERO&#x8FD9;&#x4E2A;&#x6BB5;" class="headerlink" title="3. &#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x53BB;&#x6389;PAGEZERO&#x8FD9;&#x4E2A;&#x6BB5;"></a>3. &#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x53BB;&#x6389;PAGEZERO&#x8FD9;&#x4E2A;&#x6BB5;</h4><p>&#x8FD9;&#x4E2A;&#x539F;&#x56E0;&#x8981;&#x6D89;&#x53CA;&#x5230;&#x6587;&#x4EF6;&#x4E2D;rebase&#x4FE1;&#x606F;&#x7684;&#x50A8;&#x5B58;&#x683C;&#x5F0F;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x56FE;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x51FA;rebase&#x8981;&#x5904;&#x7406;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x4E0A;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x5728;&#x6587;&#x4EF6;&#x4E2D;&#x5E76;&#x4E0D;&#x662F;&#x4EE5;&#x6307;&#x9488;&#x6570;&#x7EC4;&#x7684;&#x5F62;&#x5F0F;&#x5B58;&#x5728;&#xFF0C;&#x800C;&#x662F;&#x4EE5;&#x4E00;&#x8FDE;&#x4E32;rebase opcode&#x7684;&#x5F62;&#x5F0F;&#x5B58;&#x5728;&#xFF0C;&#x4E0A;&#x9762;&#x770B;&#x5230;&#x7684;&#x4E00;&#x4E2A;&#x4E2A;&#x6307;&#x9488;&#x5176;&#x5B9E;&#x662F; Mach O View &#x8FD9;&#x4E2A;&#x8F6F;&#x4EF6;&#x5E2E;&#x6211;&#x4EEC;&#x5C06;opcode&#x6574;&#x7406;&#x5F97;&#x5230;&#x7684;&#x3002;</p>
<p><img src="/posts/convert-iOS-app-to-dynamic-library/rebase_opcode.jpg" alt=""></p>
<p>&#x8FD9;&#x4E9B;opcode&#x4E2D;&#x6709;&#x4E00;&#x79CD;&#x64CD;&#x4F5C;&#x6BD4;&#x8F83;&#x5173;&#x952E;&#xFF0C;REBASE_OPCODE_SET_SEGMENT_AND_OFFSET_ULEB&#x3002;</p>
<p><img src="/posts/convert-iOS-app-to-dynamic-library/rebase_opcode_set_segment.jpg" alt=""></p>
<p>&#x8FD9;&#x4E2A;opcode&#x7684;&#x610F;&#x601D;&#x662F;, &#x63A5;&#x4E0B;&#x53BB;&#x9700;&#x8981;&#x8C03;&#x6574;&#x6587;&#x4EF6;&#x7684;&#x4E2D;&#x7684;&#x7B2C;2&#x4E2A;&#x6BB5;&#xFF0C;&#x5C31;&#x662F;&#x56FE;&#x4E2D;segment(2)&#x6240;&#x8868;&#x793A;&#x7684;&#x542B;&#x4E49;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x628A;PAGEZERO&#x8FD9;&#x4E2A;&#x6BB5;&#x7ED9;&#x53BB;&#x6389;&#x4E86;&#xFF0C;&#x6587;&#x4EF6;&#x4E2D;&#x5404;&#x4E2A;&#x6BB5;&#x7684;&#x5E8F;&#x53F7;&#x4E5F;&#x5C31;&#x90FD;&#x9519;&#x4F4D;&#x4E86;&#xFF0C;&#x4E0E;rebase&#x4E2D;&#x7684;&#x4FE1;&#x606F;&#x5C31;&#x5BF9;&#x5E94;&#x4E0D;&#x4E0A;&#x4E86;&#x3002;<br>&#x800C;&#x4E14;&#x628A;&#x8FD9;&#x4E2A;&#x6BB5;&#x5927;&#x5C0F;&#x6539;&#x4E3A;0&#xFF0C;&#x4E5F;&#x662F;&#x4E0D;&#x884C;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;dyld&#x5728;&#x52A0;&#x8F7D;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4F1A;&#x91CD;&#x65B0;&#x81EA;&#x52A8;&#x8FC7;&#x6EE4;&#x6389;&#x5927;&#x5C0F;&#x4E3A;0&#x7684;&#x6BB5;&#xFF0C;&#x4E5F;&#x4F1A;&#x5BFC;&#x81F4;&#x540C;&#x6837;&#x7684;&#x6BB5;&#x5E8F;&#x53F7;&#x9519;&#x4F4D;&#x7684;&#x95EE;&#x9898;&#x3002;&#xFF08;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x540C;&#x5B66;&#x53EF;&#x4EE5;&#x770B;&#x4E0B;dyld&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x5728;ImageLoaderMachO&#x7C7B;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x91CC;&#xFF09;<br>&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5FC5;&#x987B;&#x8981;&#x4FDD;&#x7559;PAGEZERO&#x8FD9;&#x4E2A;&#x6BB5;&#xFF0C;&#x540C;&#x65F6;&#x5927;&#x5C0F;&#x4E0D;&#x80FD;&#x4E3A;0&#x3002;</p>
<h3 id="&#x4FEE;&#x6539;&#x7B26;&#x53F7;&#x8868;"><a href="#&#x4FEE;&#x6539;&#x7B26;&#x53F7;&#x8868;" class="headerlink" title="&#x4FEE;&#x6539;&#x7B26;&#x53F7;&#x8868;"></a>&#x4FEE;&#x6539;&#x7B26;&#x53F7;&#x8868;</h3><p>&#x6B63;&#x5E38;&#x7684;&#x7EBF;&#x4E0A;&#x5E94;&#x7528;&#x662F;&#x4E0D;&#x5B58;&#x5728;&#x7B26;&#x53F7;&#x8868;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x4F60;&#x4E4B;&#x524D;&#x7528;&#x4E86;&#x6211;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x5DE5;&#x5177; <a href="https://github.com/tobefuturer/restore-symbol" target="_blank" rel="external">restore-symbol</a> &#x6765;&#x6062;&#x590D;&#x7B26;&#x53F7;&#x8868;&#x7684;&#x8BDD;&#xFF0C;&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x81EA;&#x7136;&#x4E5F;&#x9700;&#x8981;&#x505A;&#x4E00;&#x4E9B;&#x5904;&#x7406;&#xFF0C;&#x5904;&#x7406;&#x65B9;&#x6CD5;&#x540C;rebase&#x7C7B;&#x4F3C;&#xFF0C;&#x51CF;&#x53BB;0xFFFFC000.</p>
<p>&#x4E0D;&#x8FC7;&#x6709;&#x4E00;&#x4E9B;&#x7B26;&#x53F7;&#x9700;&#x8981;&#x5355;&#x72EC;&#x8FC7;&#x6EE4;&#xFF0C;&#x6BD4;&#x5982;&#x8FD9;&#x4E2A;&#xFF1A;</p>
<p><img src="/posts/convert-iOS-app-to-dynamic-library/symbol_table_radr.jpg" alt=""></p>
<p>&#x8FD9;&#x4E2A;radr://5614542&#x662F;&#x4E2A;&#x4EC0;&#x4E48;&#x795E;&#x5947;&#x7684;&#x7B26;&#x53F7;&#x5462;&#xFF0C;google&#x5C31;&#x80FD;&#x53D1;&#x73B0;&#xFF0C;&#x5FF5;&#x831C;&#x7684;twitter&#x4E0A;&#x63D0;&#x8FC7;&#x8FD9;&#x4E2A;&#x5947;&#x8469;&#x7684;&#x7B26;&#x53F7;&#x3002;(&#x5973;&#x795E;&#x679C;&#x7136;&#x662F;&#x5973;&#x795E;, &#x68D2;~ &#x1F602;)</p>
<p><img src="/posts/convert-iOS-app-to-dynamic-library/symbol_radr.jpg" alt=""></p>
<h1 id="&#x5B9E;&#x9645;&#x6548;&#x679C;"><a href="#&#x5B9E;&#x9645;&#x6548;&#x679C;" class="headerlink" title="&#x5B9E;&#x9645;&#x6548;&#x679C;"></a>&#x5B9E;&#x9645;&#x6548;&#x679C;</h1><p>&#x5DE5;&#x5177;&#x5F00;&#x6E90;&#x5728;<a href="https://github.com/tobefuturer/app2dylib" target="_blank" rel="external">github</a>&#x4E0A;&#xFF0C;&#x7528;&#x6CD5;&#xFF1A;</p>
<p>1.&#x4E0B;&#x8F7D;&#x6E90;&#x7801;&#x7F16;&#x8BD1;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git clone --recursive https://github.com/tobefuturer/app2dylib.git</div><div class="line">cd app2dylib &amp;&amp; make</div><div class="line">./app2dylib</div></pre></td></tr></table></figure>
<p>2.&#x628A;&#x652F;&#x4ED8;&#x5B9D;arm64&#x7838;&#x58F3;&#xFF0C;&#x7136;&#x540E;&#x63D0;&#x53D6;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x5DE5;&#x5177;&#x628A;&#x652F;&#x4ED8;&#x5B9D;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x8F6C;&#x6210;&#x52A8;&#x6001;&#x5E93;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./app2dylib /tmp/AlipayWallet -o /tmp/libAlipayApp.dylib</div></pre></td></tr></table></figure>
<p>3.&#x7528; Xcode &#x65B0;&#x5EFA;&#x5DE5;&#x7A0B;&#xFF0C;&#x5E76;&#x628A;&#x65B0;&#x751F;&#x6210;&#x7684;dylib&#x62D6;&#x8FDB;&#x53BB;&#xFF0C;&#x8C03;&#x6574;&#x597D;&#x5404;&#x9879;&#x8BBE;&#x7F6E;.<br><img src="/posts/convert-iOS-app-to-dynamic-library/xcode_setting.jpg" alt=""></p>
<p>Run Script&#x91CC;&#x7684;&#x4EE3;&#x7801;(&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x5BF9;dylib&#x8FDB;&#x884C;&#x7B7E;&#x540D;)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd ${BUILT_PRODUCTS_DIR}</div><div class="line">cd ${FULL_PRODUCT_NAME}</div><div class="line">/usr/bin/codesign --force --sign ${EXPANDED_CODE_SIGN_IDENTITY} --timestamp=none libAlipayApp.dylib</div></pre></td></tr></table></figure>
<p>4.&#x600E;&#x4E48;&#x8C03;&#x7528;&#x52A8;&#x6001;&#x5E93;&#x91CC;&#x7684;&#x65B9;&#x6CD5;&#x5462;&#xFF1F;</p>
<p>&#x4E3A;&#x65B9;&#x4FBF;&#x5927;&#x5BB6;&#x5C1D;&#x8BD5;&#xFF0C;&#x8FD9;&#x91CC;&#x9009;&#x4E24;&#x4E2A;&#x5206;&#x6790;&#x8D77;&#x6765;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x7684;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6F14;&#x793A;&#x7ED9;&#x5927;&#x5BB6;&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x662F;OC&#x7684;&#x65B9;&#x6CD5; <code>+[aluSecurity rsaEncryptText:pubKey:]</code>, &#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;oc&#x8FD0;&#x884C;&#x65F6;&#x8C03;&#x7528;&#x3002;</p>
<p>&#x53E6;&#x4E00;&#x4E2A;&#x662F;C&#x7684;&#x51FD;&#x6570; <code>int base64_encode(char * output, int * output_length, char * input, int input_length)</code><br>&#x8FD9;&#x4E2A;&#x9700;&#x8981;&#x5148;&#x786E;&#x5B9A; base64_encode &#x8FD9;&#x4E2A;C&#x51FD;&#x6570;&#x7684;&#x51FD;&#x6570;&#x7B7E;&#x540D;&#x548C;&#x5728;dylib&#x4E2D;&#x7684;&#x504F;&#x79FB;&#x5730;&#x5740;&#xFF08;&#x6211;&#x8FD9;&#x8FB9;&#x7684;9.9.3&#x7248;&#x672C;&#x662F;0xa798e4&#xFF09;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;ida&#x5206;&#x6790;&#x5F97;&#x5230;&#x3002;</p>
<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;<br><img src="/posts/convert-iOS-app-to-dynamic-library/run_result.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line">#import &lt;dlfcn.h&gt;</div><div class="line"></div><div class="line">#import &lt;mach/mach.h&gt;</div><div class="line">#import &lt;mach-o/loader.h&gt;</div><div class="line">#import &lt;mach-o/dyld.h&gt;</div><div class="line">#import &lt;objc/runtime.h&gt;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">int main(int argc, char * argv[]) {</div><div class="line">    NSLog(@&quot;\n===Start===\n&quot;);</div><div class="line">    NSString * dylibName = @&quot;libAlipayApp&quot;;</div><div class="line">    NSString * path = [[NSBundle mainBundle] pathForResource:dylibName ofType:@&quot;dylib&quot;];</div><div class="line">    if (dlopen(path.UTF8String, RTLD_NOW) == NULL){</div><div class="line">        NSLog(@&quot;dlopen failed &#xFF0C;error %s&quot;, dlerror());</div><div class="line">        return 0;</div><div class="line">    };</div><div class="line">    </div><div class="line">    //&#x8FD0;&#x884C;&#x65F6; &#x76F4;&#x63A5;&#x8C03;&#x7528;oc&#x65B9;&#x6CD5;</div><div class="line">    NSString * plain = @&quot;alipay&quot;;</div><div class="line">    NSString * pubkey = @&quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDZ6i9VNEGEaZaYE7XffA9XRj15cp/ZKhHYY43EEva8LIhCWi29EREaF4JjZVMwFpUAfrL+9gpA7NMQmaMRHbrz1KHe2Ho4HpUhEac8M9zUbNvaDKSlhx0lq/15TQP+57oQbfJ9oKKd+he4Yd6jpBI3UtGmwJyN/T1S0DQ0aXR8OQIDAQAB&quot;;</div><div class="line">    NSString * cipher = [NSClassFromString(@&quot;aluSecurity&quot;) performSelector:NSSelectorFromString(@&quot;rsaEncryptText:pubKey:&quot;) withObject:plain withObject:pubkey];</div><div class="line">    NSLog(@&quot;\n-----------call oc method---------\n&#x660E;&#x6587;&#xFF1A;%@\n&#x5BC6;&#x6587;&#xFF1A; %@\n-----------------------------------&quot;, plain,cipher);</div><div class="line">    </div><div class="line">    //&#x786E;&#x8BA4;dylib&#x52A0;&#x8F7D;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x5730;&#x5740;</div><div class="line">    uint64_t slide = 0;</div><div class="line">    for (int i = 0; i &lt;  _dyld_image_count(); i ++)</div><div class="line">        if ([[NSString stringWithUTF8String:_dyld_get_image_name(i)] isEqualToString:path])</div><div class="line">            slide = _dyld_get_image_vmaddr_slide(i);</div><div class="line">    assert(slide != 0);</div><div class="line">    </div><div class="line">    </div><div class="line">    typedef int (*BASE64_ENCODE_FUNC_TYPE) (char * output, int * output_size , char * input, int input_length);</div><div class="line">    /** &#x6839;&#x636E;&#x504F;&#x79FB;&#x7B97;&#x51FA;&#x51FD;&#x6570;&#x5730;&#x5740;&#xFF0C; &#x7136;&#x540E;&#x8C03;&#x7528;*/</div><div class="line">    long long base64_encode_offset_in_dylib = 0xa798e4;</div><div class="line">    BASE64_ENCODE_FUNC_TYPE base64_encode = (BASE64_ENCODE_FUNC_TYPE)(slide + base64_encode_offset_in_dylib);</div><div class="line">    char output[1000] = {0};</div><div class="line">    int length = 1000;</div><div class="line">    char * input = &quot;alipay&quot;;</div><div class="line">    base64_encode(output, &amp; length,  input, (int)strlen(input));</div><div class="line">    NSLog(@&quot;\n-----------call c function---------\nbase64: %s -&gt; %s\n-----------------------------------&quot;, input,  output);</div><div class="line">}</div></pre></td></tr></table></figure>
<p>ps&#xFF1A;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x6211;&#x523B;&#x610F;&#x9664;&#x6389;&#x4E86;&#x754C;&#x9762;&#x90E8;&#x5206;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x4E3A;&#x652F;&#x4ED8;&#x5B9D;&#x7684;+load&#x51FD;&#x6570;&#x91CC;swizzle&#x4E86;UI&#x5C42;&#x7684;&#x4E00;&#x4E9B;&#x65B9;&#x6CD5;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;crash&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x5E72;&#x6389;&#x90A3;&#x4E9B;+load&#x65B9;&#x6CD5;&#x7684;&#x8BDD;&#xFF0C;&#x770B;&#x4E0B;&#x9762;&#x3002;</p>
<h1 id="&#x5173;&#x4E8E;&#x7ED5;&#x8FC7;&#x68C0;&#x6D4B;&#x4EE3;&#x7801;"><a href="#&#x5173;&#x4E8E;&#x7ED5;&#x8FC7;&#x68C0;&#x6D4B;&#x4EE3;&#x7801;" class="headerlink" title="&#x5173;&#x4E8E;&#x7ED5;&#x8FC7;&#x68C0;&#x6D4B;&#x4EE3;&#x7801;"></a>&#x5173;&#x4E8E;&#x7ED5;&#x8FC7;&#x68C0;&#x6D4B;&#x4EE3;&#x7801;</h1><p>&#x6587;&#x7AE0;&#x5F00;&#x5934;&#x7684;&#x7B80;&#x4ECB;&#x4E2D;&#x6709;&#x63D0;&#x5230;&#xFF0C;&#x4EE5;&#x52A8;&#x6001;&#x5E93;&#x7684;&#x5F62;&#x5F0F;&#x52A0;&#x8F7D;&#xFF0C;&#x80FD;&#x591F;&#x7ED5;&#x8FC7;&#x5E94;&#x7528;&#x7684;&#x68C0;&#x6D4B;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x8BF4;&#x6CD5;&#x4E0D;&#x5B8C;&#x5168;&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x628A;&#x68C0;&#x6D4B;&#x4EE3;&#x7801;&#x5199;&#x5728;&#x7C7B;&#x7684;+load&#x65B9;&#x6CD5;&#x91CC;&#x6216;&#x8005;mod_init_func&#x51FD;&#x6570;&#xFF08; &#x5168;&#x5C40;&#x9759;&#x6001;&#x53D8;&#x91CF;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x548C;<code>__attribute__((constructor))</code>&#x6307;&#x5B9A;&#x7684;&#x51FD;&#x6570; &#xFF09;&#x91CC;&#xFF0C;&#x5728;dylib&#x52A0;&#x8F7D;&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x8C03;&#x7528;&#x7684;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x4E5F;&#x5C31;&#x884D;&#x751F;&#x51FA;&#x4E24;&#x79CD;&#x914D;&#x642D;&#x7684;&#x5BF9;&#x6297;&#x65B9;&#x6848;&#xFF1A;</p>
<p>i&#xFF09;&#x8D8A;&#x72F1;&#x673A;<br>+load&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x662F;&#x5728;libobjc.dylib&#x4E2D;&#x7684;call_load_methods&#x51FD;&#x6570;&#xFF0C; mod_init_func&#x51FD;&#x6570;&#x7684;&#x8C03;&#x7528;&#x662F;&#x5728;dyld&#x4E2D;&#x7684;doModInitFunctions&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;CydiaSubstrate inline hook&#x6389;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x800C;&#x4E14;&#x52A8;&#x6001;&#x5E93;&#x662F;&#x7531;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x52A0;&#x8F7D;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x63A7;&#x5236;hook&#x548C;&#x52A0;&#x8F7D;dylib&#x7684;&#x65F6;&#x5E8F;&#x3002;</p>
<p>ii) &#x975E;&#x8D8A;&#x72F1;&#x673A;<br>&#x975E;&#x8D8A;&#x72F1;&#x673A;&#x4E0A;&#xFF0C;&#x6CA1;&#x6709;&#x529E;&#x6CD5;inline hook&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x5229;&#x7528;_dyld_register_func_for_add_image &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x6CE8;&#x518C;&#x56DE;&#x8C03;&#xFF0C;&#x8FD9;&#x4E2A;&#x56DE;&#x8C03;&#x662F;&#x53D1;&#x751F;&#x5728;&#x52A8;&#x6001;&#x5E93;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x540E;&#xFF0C;+load&#x65B9;&#x6CD5;&#x548C;mod_init_func&#x51FD;&#x6570;&#x8C03;&#x7528;&#x524D;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x5728;&#x8FD9;&#x4E2A;&#x56DE;&#x8C03;&#x91CC;&#x628A;+load&#x65B9;&#x6CD5;&#x6539;&#x540D;&#xFF0C;&#x628A;mod_init_func&#x6BB5;&#x6539;&#x540D;&#x7B49;&#x7B49;&#xFF0C;&#x4E5F;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x5F97;&#x5404;&#x79CD;&#x68C0;&#x6D4B;&#x51FD;&#x6570;&#x6CA1;&#x6CD5;&#x8C03;&#x7528;&#x4E86;&#x3002;</p>
<p>&#x603B;&#x4E4B;&#xFF0C;&#x4E3B;&#x8981;&#x7684;&#x63A7;&#x5236;&#x6743;&#x8FD8;&#x662F;&#x5728;&#x6211;&#x4EEC;&#x624B;&#x4E2D;&#x3002;</p>
<h1 id="&#x5DE5;&#x5177;&#x5F00;&#x6E90;&#x5730;&#x5740;"><a href="#&#x5DE5;&#x5177;&#x5F00;&#x6E90;&#x5730;&#x5740;" class="headerlink" title="&#x5DE5;&#x5177;&#x5F00;&#x6E90;&#x5730;&#x5740;"></a>&#x5DE5;&#x5177;&#x5F00;&#x6E90;&#x5730;&#x5740;</h1><p><a href="https://github.com/tobefuturer/app2dylib" target="_blank" rel="external">https://github.com/tobefuturer/app2dylib</a></p>
<p>&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#xFF1A;<br>iPhone 6Plus &#x3001;iOS 9.3.1 &#x3001;arm64<br>&#x652F;&#x4ED8;&#x5B9D;9.9.3</p>
<p>&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x9047;&#x5230;&#x5404;&#x79CD;&#x5947;&#x8469;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x53BB;github&#x4E0A;&#x63D0;issue&#xFF0C;&#x6216;&#x8005;email(tobefuturer@gmail.com)&#xFF0C;&#x63D0;&#x95EE;&#x65F6;&#x8BF7;&#x63CF;&#x8FF0;&#x6E05;&#x695A;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#x548C;&#x5DF2;&#x7ECF;&#x5C1D;&#x8BD5;&#x8FC7;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002;</p>
<h1 id="&#x53C2;&#x8003;&#x94FE;&#x63A5;-amp-&#x81F4;&#x8C22;"><a href="#&#x53C2;&#x8003;&#x94FE;&#x63A5;-amp-&#x81F4;&#x8C22;" class="headerlink" title="&#x53C2;&#x8003;&#x94FE;&#x63A5;&amp;&#x81F4;&#x8C22;"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;&amp;&#x81F4;&#x8C22;</h1><ol>
<li>dyld&#x7684;&#x6E90;&#x7801;&#xFF1A;<a href="https://opensource.apple.com/source/dyld/" target="_blank" rel="external">https://opensource.apple.com/source/dyld/</a></li>
<li>&#x611F;&#x8C22;&#x72D7;&#x54E5;&#x7684;iOS&#x9006;&#x5411;&#x7FA4;&#x91CC; @Ouroboros&#xFF0C; @Misty&#xFF0C;@&#x5F20;&#x603B; &#x4E09;&#x4F4D;&#x5927;&#x795E;&#x7684;&#x6FC0;&#x70C8;&#x8BA8;&#x8BBA;&#xFF0C;&#x8FD8;&#x6709;&#x5E2E;&#x6211;&#x7838;&#x652F;&#x4ED8;&#x5B9D;&#x58F3;&#x7684; @{}</li>
<li>&#x987A;&#x4FBF;&#x63A8;&#x5E7F;&#x4E0B;iOS&#x9006;&#x5411;&#x7684;&#x8BBA;&#x575B; <a href="http://iosre.com/" target="_blank" rel="external">http://iosre.com/</a></li>
</ol>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    
                        <li>
                            <a href="https://github.com/tobefuturer" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                        <li>
                            <a href="mailto:tobefuturer@gmail.com" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                </ul>
                <ul class="list-inline text-center">
                    
                        <p >杨君</p>
                    
                    
                        <p >Email: tobefuturer@gmail.com</p>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Jun 2016</p>
                <!--
                <p class="copyright text-muted">Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
                -->
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>